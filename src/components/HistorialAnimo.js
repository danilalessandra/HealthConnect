import React, { useState, useEffect } from 'react';
import { Bar, Line } from 'react-chartjs-2';
import styles from '../styles/HistorialAnimo.module.css';
import {
    Chart as ChartJS,
    CategoryScale,
    LinearScale,
    BarElement,
    LineElement,
    PointElement,
    Title,
    Tooltip,
    Legend,
} from 'chart.js';
import 'chart.js/auto';
import DatePicker from 'react-datepicker';
import 'react-datepicker/dist/react-datepicker.css';
import { useNavigate } from 'react-router-dom';

ChartJS.register(
    CategoryScale,
    LinearScale,
    BarElement,
    LineElement,
    PointElement,
    Title,
    Tooltip,
    Legend
);

const HistorialAnimo = () => {
    const [selectedTab, setSelectedTab] = useState('Gr치fico de barras');
    const [startDate, setStartDate] = useState(null);
    const [endDate, setEndDate] = useState(null);
    const [chartData, setChartData] = useState({ labels: [], datasets: [{ label: 'Intensidad', data: [], backgroundColor: '#9400D3' }] });
    const [lineChartData, setLineChartData] = useState(null);
    const [moodLogs, setMoodLogs] = useState([]);
    const navigate = useNavigate();

    // Funci칩n para obtener el historial de 치nimo (simulada con datos est치ticos)
    const obtenerHistorialAnimoSimulado = () => {
        return [
            { log_id: 1, log_date: '2025-05-01', mood_score: 4, notes: 'Me sent칤 bastante bien.' },
            { log_id: 2, log_date: '2025-05-05', mood_score: 5, notes: 'Un d칤a excelente.' },
            { log_id: 3, log_date: '2025-05-10', mood_score: 3, notes: 'D칤a normal.' },
            { log_id: 4, log_date: '2025-05-15', mood_score: 2, notes: 'Me sent칤 un poco bajo de 치nimo.' },
            { log_id: 5, log_date: '2025-05-20', mood_score: 4, notes: 'Mejorando.' },
            { log_id: 6, log_date: '2025-05-25', mood_score: 3, notes: 'Sin cambios notables.' },
            { log_id: 7, log_date: '2025-05-30', mood_score: 5, notes: '춰Genial!' },
            { log_id: 8, log_date: '2025-06-04', mood_score: 4, notes: 'Productivo.' },
            { log_id: 9, log_date: '2025-06-09', mood_score: 3, notes: 'Un poco cansado.' },
            { log_id: 10, log_date: '2025-06-14', mood_score: 4, notes: 'Animado.' },
            { log_id: 11, log_date: '2025-06-19', mood_score: 2, notes: 'D칤a dif칤cil.' },
            { log_id: 12, log_date: '2025-06-24', mood_score: 5, notes: 'Muy feliz.' },
        ];
    };

    useEffect(() => {
        // Simulaci칩n de obtenci칩n de datos del backend
        const data = obtenerHistorialAnimoSimulado();
        setMoodLogs(data);
        // Procesar datos iniciales para el gr치fico de barras (칰ltimos 30 d칤as)
        const last30DaysLogs = data.slice(-12); // Tomando los 칰ltimos 12 para simular 30 d칤as
        const labels = last30DaysLogs.map(log => new Date(log.log_date).toLocaleDateString('es-CL', { month: 'short', day: 'numeric' }));
        const intensityData = last30DaysLogs.map(log => log.mood_score);
        setChartData({ labels, datasets: [{ label: 'Intensidad', data: intensityData, backgroundColor: '#9400D3' }] });
        // Preparar datos para el gr치fico de l칤neas tambi칠n
        const lineLabels = data.map(log => new Date(log.log_date).toLocaleDateString('es-CL', { month: 'short', day: 'numeric' }));
        const lineIntensityData = data.map(log => log.mood_score);
        setLineChartData({
            labels: lineLabels,
            datasets: [{ label: 'Intensidad', data: lineIntensityData, borderColor: '#9400D3', tension: 0.3, pointRadius: 5, pointHoverRadius: 7, pointBackgroundColor: '#9400D3' }],
        });
    }, []);

    const chartOptions = {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                max: 5,
                ticks: { display: false, stepSize: 1 },
                grid: { display: false },
            },
            x: { grid: { display: false } },
        },
        plugins: { legend: { display: false }, tooltip: { callbacks: { label: (context) => `Intensidad: ${context.parsed.y}/5` } } },
    };

    const handleTabChange = (tab) => {
        setSelectedTab(tab);
    };

    const handleStartDateChange = (date) => {
        setStartDate(date);
    };

    const handleEndDateChange = (date) => {
        setEndDate(date);
    };

    const handleAplicarFiltro = () => {
        // Aqu칤 ir칤a la l칩gica para filtrar los datos seg칰n las fechas
        console.log('Filtrando por:', startDate, endDate);
        // Por ahora, simplemente mostramos todos los datos
    };

    const handleVerPerfilClick = () => {
        navigate('/perfil-usuario');
    };

    return (
        <div className={styles.container}>
            <div className={styles.header}>
                <button onClick={handleVerPerfilClick} className={styles.perfilButton}>
                    Mi Perfil
                </button>
                <h2 className={styles.title}>Historial del estado de 치nimo</h2>
                <p className={styles.description}>
                    Realice un seguimiento de sus patrones emocionales a lo largo del tiempo para identificar tendencias y desencadenantes.
                </p>
            </div>

            <div className={styles.filter}>
                <div className={styles.datePickerContainer}>
                    <label htmlFor="startDate" className={styles.label}>De</label>
                    <DatePicker
                        id="startDate"
                        className={styles.datePickerInput}
                        dateFormat="dd/MM/yyyy"
                        selected={startDate}
                        onChange={handleStartDateChange}
                        placeholderText="Seleccione la fecha de inicio"
                    />
                </div>
                <div className={styles.datePickerContainer}>
                    <label htmlFor="endDate" className={styles.label}>A</label>
                    <DatePicker
                        id="endDate"
                        className={styles.datePickerInput}
                        dateFormat="dd/MM/yyyy"
                        selected={endDate}
                        onChange={handleEndDateChange}
                        placeholderText="Seleccione la fecha de finalizaci칩n"
                    />
                </div>
                <button className={styles.applyButton} onClick={handleAplicarFiltro}>Aplicar filtro</button>
            </div>

            <div className={styles.tabs}>
                <button
                    className={`${styles.tab} ${selectedTab === 'Gr치fico de barras' ? styles.activeTab : ''}`}
                    onClick={() => handleTabChange('Gr치fico de barras')}
                >
                    Gr치fico de barras
                </button>
                <button
                    className={`${styles.tab} ${selectedTab === 'Gr치fico de l칤neas' ? styles.activeTab : ''}`}
                    onClick={() => handleTabChange('Gr치fico de l칤neas')}
                >
                    Gr치fico de l칤neas
                </button>
                <button
                    className={`${styles.tab} ${selectedTab === 'Vista de calendario' ? styles.activeTab : ''}`}
                    onClick={() => handleTabChange('Vista de calendario')}
                >
                    Vista de calendario
                </button>
            </div>

            <div className={styles.content}>
                {selectedTab === 'Gr치fico de barras' && chartData.labels.length > 0 && (
                    <div className={styles.chartContainer}>
                        <h3 className={styles.chartTitle}>Tendencias del estado de 치nimo - 칔ltimos 30 d칤as</h3>
                        <Bar data={chartData} options={chartOptions} />
                    </div>
                )}
                {selectedTab === 'Gr치fico de l칤neas' && lineChartData && lineChartData.labels.length > 0 && (
                    <div className={styles.chartContainer}>
                        <h3 className={styles.chartTitle}>Tendencias del estado de 치nimo</h3>
                        <Line data={lineChartData} options={chartOptions} />
                    </div>
                )}
                {selectedTab === 'Vista de calendario' && (
                    <div className={styles.calendarContainer}>
                        <h3>Vista de calendario (Pr칩ximamente)</h3>
                        {/* Aqu칤 ir칤a la l칩gica para mostrar un calendario */}
                        <p>Esta funci칩n estar치 disponible pronto.</p>
                    </div>
                )}
                {moodLogs.length === 0 && selectedTab !== 'Vista de calendario' && (
                    <p className={styles.noData}>No hay registros de estado de 치nimo disponibles.</p>
                )}
            </div>

            <div className={styles.detailsContainer}>
                <h3 className={styles.detailsTitle}>Detalles del estado de 치nimo</h3>
                <ul className={styles.detailsList}>
                    {moodLogs.map((log) => (
                        <li key={log.log_id} className={styles.detailItem}>
                            <div className={styles.moodIcon}>
                                <div className={styles.iconPlaceholder}>游땕</div> {/* Icono basado en el estado de 치nimo */}
                            </div>
                            <div className={styles.moodInfo}>
                                <div className={styles.moodDate}>{new Date(log.log_date).toLocaleDateString()}</div>
                                <div className={styles.moodText}>Intensidad: {log.mood_score}/5 {log.notes && `- Notas: ${log.notes}`}</div>
                            </div>
                            <div className={styles.optionsIcon}>
                                <div>...</div> {/* Opciones como editar/eliminar */}
                            </div>
                        </li>
                    ))}
                </ul>
                {moodLogs.length === 0 && <p className={styles.noData}>No hay detalles de estado de 치nimo para mostrar.</p>}
            </div>

            <div className={styles.actions}>
                <button className={styles.exportButton}>Exportar datos</button>
                <button className={styles.shareButton}>Compartir con el Doctor</button>
            </div>
        </div>
    );
};

export default HistorialAnimo;
















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































